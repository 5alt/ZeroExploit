DROP DATABASE IF EXISTS zeroexploit;

CREATE DATABASE `zeroexploit` DEFAULT CHARACTER SET utf8 collate utf8_general_ci;

USE zeroexploit;

# type=1 返回是text/html的基准请求
# type=2 是ajax请求
# type=3 其他请求

CREATE TABLE `http` (
	`id` int NOT NULL AUTO_INCREMENT,
	`gid` int(11) NOT NULL,
	`req` LongText COLLATE utf8_bin NOT NULL,
	`rsp` LongText COLLATE utf8_bin NOT NULL,
	`time` int(11) NOT NULL,
	`type` int(8) NOT NULL,
	`signature` varchar(64) NOT NULL,
  `checked` int(3) DEFAULT 0,
	PRIMARY KEY (`id`)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `detector`(
  `id` int NOT NULL AUTO_INCREMENT,
  `hash` varchar(255) NOT NULL,
  `url` TEXT,
  `method` varchar(255) NOT NULL,
  `info` TEXT,
  `show` int(3) DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY (`hash`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `siteinfo`(
  `id` int NOT NULL AUTO_INCREMENT,
  `host` varchar(255) NOT NULL,
  `key` varchar(255) NOT NULL,
  `value` varchar(255) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

# type: int float url str array
CREATE TABLE `requests`(
  `id` int NOT NULL AUTO_INCREMENT,
  `requestid` int NOT NULL,
  `method` varchar(255) NOT NULL,
  `key` varchar(255) NOT NULL,
  `type` varchar(255) NOT NULL,
  `checked` int DEFAULT 0,
  PRIMARY KEY (`id`),
  FOREIGN KEY (requestid) REFERENCES http(id) ON UPDATE CASCADE ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `result`(
  `id` int NOT NULL AUTO_INCREMENT,
  `requestid` int NOT NULL,
  `method` varchar(255) NOT NULL,
  `key` varchar(255) NOT NULL,
  `url` TEXT,
  `result` varchar(255) NOT NULL,
  `info` TEXT,
  `exploit` varchar(255) NOT NULL,
  PRIMARY KEY (`id`),
  FOREIGN KEY (requestid) REFERENCES http(id) ON UPDATE CASCADE ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

# status: wait, vul, safe 
CREATE TABLE `payload`(
  `id` int NOT NULL AUTO_INCREMENT,
  `requestid` int NOT NULL,
  `url` TEXT,
  `param` TEXT,
  `payload` TEXT,
  `comment` TEXT,
  `status` VARCHAR(64) DEFAULT 'wait',
  PRIMARY KEY (`id`),
  FOREIGN KEY (requestid) REFERENCES http(id) ON UPDATE CASCADE ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

