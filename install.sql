DROP DATABASE IF EXISTS zeroexploit;

CREATE DATABASE `zeroexploit` DEFAULT CHARACTER SET utf8 collate utf8_general_ci;

USE zeroexploit;

# type=1 返回是text/html的基准请求
# type=2 是ajax请求
# type=3 其他请求

CREATE TABLE `http` (
	`id` int NOT NULL AUTO_INCREMENT,
	`gid` int(11) NOT NULL,
	`req` LongText COLLATE utf8_bin NOT NULL,
	`rsp` LongText COLLATE utf8_bin NOT NULL,
	`time` int(11) NOT NULL,
	`type` int(8) NOT NULL,
	`signature` varchar(64) NOT NULL,
	PRIMARY KEY (`id`)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;

# status: wait, vul, safe 
CREATE TABLE `payload`(
  `hash` varchar(255) NOT NULL,
  `requestid` int NOT NULL,
  `url` TEXT,
  `body` TEXT,
  `payload` TEXT,
  `comment` TEXT,
  `status` VARCHAR(64) DEFAULT 'wait',
  PRIMARY KEY (`hash`),
  FOREIGN KEY (requestid) REFERENCES http(id) ON UPDATE CASCADE ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `detector`(
  `id` int NOT NULL AUTO_INCREMENT,
  `hash` varchar(255) NOT NULL,
  `url` TEXT,
  `method` varchar(255) NOT NULL,
  `info` TEXT,
  PRIMARY KEY (`id`),
  UNIQUE KEY (`hash`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;