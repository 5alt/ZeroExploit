DROP DATABASE IF EXISTS zeroexploit;

CREATE DATABASE `zeroexploit` DEFAULT CHARACTER SET utf8 collate utf8_general_ci;

USE zeroexploit;

# type=1 返回是text/html的基准请求
# type=2 是ajax请求
# type=3 其他请求
# checked=0 是未处理
# checked=1 按参数分解处理

CREATE TABLE `http` (
	`id` int NOT NULL AUTO_INCREMENT,
	`gid` int(11) NOT NULL,
  `host` varchar(255) NOT NULL,
	`req` LongText COLLATE utf8_bin NOT NULL,
	`rsp` LongText COLLATE utf8_bin NOT NULL,
	`time` int(11) NOT NULL,
	`type` int(8) NOT NULL,
	`signature` varchar(64) NOT NULL,
  `checked` int(3) DEFAULT 0,
	PRIMARY KEY (`id`),
  UNIQUE KEY (`signature`)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `detector`(
  `id` int NOT NULL AUTO_INCREMENT,
  `hash` varchar(255) NOT NULL,
  `url` TEXT,
  `method` varchar(255) NOT NULL,
  `info` TEXT,
  `show` int(3) DEFAULT 1,
  PRIMARY KEY (`id`),
  UNIQUE KEY (`hash`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `siteinfo`(
  `host` varchar(255) NOT NULL,
  `key` varchar(255) NOT NULL,
  `value` varchar(255) NOT NULL,
  PRIMARY KEY (`host`, `key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

# type: int float url str array
CREATE TABLE `requests`(
  `id` int NOT NULL AUTO_INCREMENT,
  `requestid` int NOT NULL,
  `method` varchar(255) NOT NULL,
  `key` varchar(255),
  `type` varchar(255),
  `checked` int DEFAULT 0,
  PRIMARY KEY (`id`),
  FOREIGN KEY (requestid) REFERENCES http(id) ON UPDATE CASCADE ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `result`(
  `id` int NOT NULL AUTO_INCREMENT,
  `requestid` int NOT NULL,
  `method` varchar(255) NOT NULL,
  `key` varchar(255) NOT NULL,
  `url` TEXT,
  `hash` varchar(255),
  `result` varchar(255) NOT NULL,
  `level` varchar(255) NOT NULL,
  `info` TEXT,
  `exploit` varchar(255) NOT NULL,
  `show` int(3) DEFAULT 1,
  PRIMARY KEY (`id`),
  FOREIGN KEY (requestid) REFERENCES http(id) ON UPDATE CASCADE ON DELETE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `hashlog`(
  `id` int NOT NULL AUTO_INCREMENT,
  `hash` varchar(255),
  PRIMARY KEY (`id`),
  UNIQUE KEY (`hash`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
