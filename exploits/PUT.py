# -*- coding: utf-8 -*-
import requests
import os
import config
author = 'md5_salt' # 可选
timeout = 5 # 建议
vtype = 'all' #value type: all/int/float/str/url/json/special
stype = 'java|asp|aspx'

# https://paper.seebug.org/403/
# https://mp.weixin.qq.com/s/uTiWDsPKEjTkN6z9QNLtSA
# https://pivotal.io/security/cve-2017-8046

def exploit(request, response, method, key, is_array=False):

    if config.dbconn().fetch_rows('result', condition="exploit='%s' and result != 'continue' and `host`='%s'" % (os.path.basename(__file__)[:-3], request['host']), order="id asc", limit="1", fetchone=True): return
    allow = requests.options(request['uri']).headers.get('Allow', '')
    if allow.find('PUT') != -1 or allow.find('PATCH') != -1:
        return {'result': 'vul', 'info': "Server support put/patch method", 'hash': None, 'level': "middle"}
    else:
        return {'result': 'safe', 'info': "Server does not support put/patch method", 'hash': None, 'level': "middle"}

if __name__ == '__main__':
    pass